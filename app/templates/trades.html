{% extends "base.html" %}

{% block title %}Croc Trader â€“ Trades{% endblock %}

{% block extra_head %}
<style>
    .content-card {
        background: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        border: 1px solid #e5e7eb;
        overflow: hidden;
    }
    .card-header {
        background: #ffffff;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .card-title { font-size: 1.125rem; font-weight: 700; color: #111827; margin: 0; }

    .table { margin-bottom: 0; font-size: 0.875rem; }
    .table thead th {
        background-color: #f9fafb;
        color: #6b7280;
        font-size: 0.7rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 1px solid #e5e7eb;
        padding: 0.7rem 0.8rem;
    }
    .table tbody td {
        padding: 0.55rem 0.8rem;
        border-bottom: 1px solid #e5e7eb;
        vertical-align: middle;
    }

    .badge-pending { background-color: #e0e7ff; color: #3730a3; }
    .badge-rejected { background-color: #fee2e2; color: #991b1b; }
    .badge-active { background-color: #dbeafe; color: #1e40af; }
    .badge-win { background-color: #d1fae5; color: #065f46; }
    .badge-loss { background-color: #ffe4e6; color: #9f1239; }

    @media (max-width: 768px) {
        .table thead th,
        .table tbody td {
            padding: 0.45rem 0.4rem;
            font-size: 0.75rem;
        }
        .hide-mobile { display: none; }
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-3">
    <h1 class="h4 mb-1">Tracked Trades</h1>
    <p class="text-muted small mb-0">
        Overview of all signals you marked for trade tracking.
    </p>
</div>

<div class="content-card">
    <div class="card-header">
        <h3 class="card-title mb-0">Trades</h3>
        <a href="/croc-signal" class="btn btn-sm btn-outline-secondary">Back to Signals</a>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>SYMBOL</th>
                    <th>SIGNAL</th>
                    <th>STATE</th>
                    <th class="hide-mobile">BUY LIMIT</th>
                    <th class="hide-mobile">STOP</th>
                    <th class="hide-mobile">TAKE PROFIT</th>
                    <th>ENTRY TIME</th>
                    <th>ENTRY</th>
                    <th>EXIT TIME</th>
                    <th>EXIT</th>
                    <th>P/L</th>
                </tr>
            </thead>
            <tbody>
                {% for t in trades %}
                <tr>
                    <td class="fw-semibold">{{ t.symbol }}</td>
                    <td>{{ t.signal }}</td>
                    <td>
                        {% if t.state %}
                            <span class="badge badge-{{ t.state }} rounded-pill px-2">{{ t.state|upper }}</span>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="font-monospace text-muted hide-mobile">
                        {{ t.buy_limit if t.buy_limit is not none else '-' }}
                    </td>
                    <td class="font-monospace text-muted hide-mobile">
                        {{ t.stop_loss if t.stop_loss is not none else '-' }}
                    </td>
                    <td class="font-monospace text-muted hide-mobile">
                        {{ t.take_profit if t.take_profit is not none else '-' }}
                    </td>

                    <td class="text-muted" style="font-size: 0.75rem;">
                        {{ t.entry_time or '-' }}
                    </td>
                    <td class="font-monospace text-muted">
                        {{ t.entry_price if t.entry_price is not none else '-' }}
                    </td>

                    <td class="text-muted" style="font-size: 0.75rem;">
                        {{ t.exit_time or '-' }}
                    </td>
                    <td class="font-monospace text-muted">
                        {{ t.exit_price if t.exit_price is not none else '-' }}
                    </td>

                    <td class="font-monospace">
                        {% if t.entry_price and (t.exit_price or t.current_price) %}
                            {% set last = t.exit_price if t.exit_price is not none else t.current_price %}
                            {% set pl = last - t.entry_price %}
                            <span class="{{ 'text-success' if pl > 0 else 'text-danger' }}">
                                {{ "%.2f"|format(pl) }}
                            </span>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="11" class="text-center py-4 text-muted">No trades tracked yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="mt-4 text-center text-muted" style="font-size: 0.75rem;">
    &copy; 2025 Croc Trader Systems
</div>
{% endblock %}
